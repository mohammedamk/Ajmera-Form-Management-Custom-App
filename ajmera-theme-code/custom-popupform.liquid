<style>
      .custompopup-wrapper {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      border-radius: 12px;
      overflow: hidden;
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      }

      .custompopup-image img {
      width: 100%;
      display: block;
      height: auto;
      }
      .custompopup-form button.close-btn {
      background: none;
      border: none;
      display: flex;
      justify-content: end;
      width: 100%;
      cursor: pointer;
      }
      .custompopup-form {
      background: #f4f4f4;
      }

      .custompopup-container {
      position: absolute;
      top: 50%;
      width: 100%;
      transform: translateY(-50%)
      }
      .custompopup-modal {
      background: #121212bf;
      position: fixed;
      z-index: 999;
      width: 100%;
      height: 100%;
      inset: 0;
      }
      .custompopup-image,.custompopup-form {
      padding: 15px;
      }
      .custompopup-image h2 {
      margin: 0;
      letter-spacing: normal;
      font-weight: 600;
      color: #0f4989;
      }

      .custompopup-image p {
      letter-spacing: normal;
      margin: 0px 0 20px 0;
      color:#000;
      }
      .custompopup-form .form-field label.label {
      display: block;
      color: #000;
      letter-spacing: normal;
      line-height: 100%;
      font-weight: 600;
      margin-bottom:10px;
      }
      span.markedrequired {
      color: red;
      }
      .custompopup-form .form-field input,.custompopup-form textarea {
      display: block;
      border: none;
      padding: 13px;
      width: 100%;
      border-radius: 12px;
      margin-bottom: 20px;
      }
      .custompopup-form button.submitbtn {
      padding: 8px 24px;
      border: none;
      background: #0f4989;
      color: #fff;
      border-radius: 12px;
      display: inline-block;
      margin-top: 20px;
      font-weight: 500;
      letter-spacing: normal;
      cursor: pointer;
      }
      .form-consent {
      display: flex;
      align-items: start;
      gap: 5px;
      }

      .form-consent label {
      letter-spacing: normal;
      line-height: 100%;
      display: inline-block;
      font-size: 13px;
      }
      #{{section.settings.formids}}{
      display:none;
      }
      .custompopup-form .form-field .radio-option label,.custompopup-form .form-field .radio-option input{
      display:inline;
      width:auto;
      letter-spacing: normal;
      color: #000;
      font-size: 14px;
      line-height: 100%;
      margin: 0;
      }
      .radiooptionswrapper {
      display: grid;
      grid-template-columns: repeat(3,1fr);
      margin-block: 20px;
      }

      .radio-option {
      display: inline-flex;
      align-items: start;
      gap: 10px;
      }
      .field-error {
      color: red;
      font-size: 13px;
      margin-top: -15px;
      margin-bottom: 15px;
      display: none;
    }
    .field-error.active {
      display: block;
    }
    .form-success-message {
    color: green;
    font-size: 14px;
    margin-top: 10px;
    margin-bottom: 15px;
    display: none;
  }

  .form-success-message.active {
    display: block;
  }
      @media(max-width: 991px) {
      .custompopup-wrapper{
      grid-template-columns: auto;
      }
      .custompopup-image img{
      display:none;
      }
      .custompopup-modal {
      overflow: auto;
      }
      .custompopup-image p{
      margin:0;
      }
      .custompopup-form .form-field input, .custompopup-form textarea{
      margin-bottom: 10px;
      }
      .custompopup-form .close-btn svg {
      height: 20px;
      width: 20px;
      }
      }
</style>

<div class="custompopup-modal" id="{{ section.settings.formids }}">
  <div class="custompopup-container">
    <div class="custompopup-wrapper">
      <!-- Left Image -->
      <div class="custompopup-image">
        <h2>{{ section.settings.heading }}</h2>
        <p>{{ section.settings.subheading }}</p>
        {% if section.settings.image != blank %}
          {{ section.settings.image | image_url: width: 1200 | image_tag }}
        {% endif %}
      </div>

      <!-- Right Form -->
      <div class="custompopup-form">
        <button class="close-btn">
          <svg width="32px" height="32px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill="#0f4989">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><title>ionicons-v5-m</title><path d="M448,256c0-106-86-192-192-192S64,150,64,256s86,192,192,192S448,362,448,256Z" style="fill:none;stroke:#0f4989;stroke-miterlimit:10;stroke-width:32px"></path><line x1="320" y1="320" x2="192" y2="192" style="fill:none;stroke:#0f4989;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"></line><line x1="192" y1="320" x2="320" y2="192" style="fill:none;stroke:#0f4989;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"></line></g>
          </svg>
        </button>
        <form method="post" id="custompopup-form-{{ section.settings.formids }}">
          <input type="hidden" name="form_type" value="contact">
          <input type="hidden" name="utf8" value="âœ“">

          {% for block in section.blocks %}
            <div class="form-field" {{ block.shopify_attributes }}>
              {% if block.settings.label != blank %}
                <label class="label">
                  {{ block.settings.label }}
                  {% if block.settings.required %}
                    <span class="markedrequired">*</span>
                  {% endif %}
                </label>
              {% endif %}

              {% case block.settings.input_type %}
                {% when 'textarea' %}
                  <textarea
                    name="contact[{{ block.settings.label | handle }}]"
                    placeholder="{{ block.settings.placeholder }}"
                    {% if block.settings.required %}
                      required
                    {% endif -%}
                  >
              </textarea>

                {% when 'select' %}
                  <select
                    name="contact[{{ block.settings.label | handle }}]"
                    {% if block.settings.required %}
                      required
                    {% endif %}
                  >
                    {% assign options = block.settings.select_options | split: ',' %}
                    {% for option in options %}
                      <option value="{{ option | strip }}">{{ option | strip }}</option>
                    {% endfor %}
                  </select>
                {% when 'radio' %}
                  {% assign options = block.settings.select_options | split: ',' %}
                  <div class="radiooptionswrapper">
                    {% for option in options %}
                      <div class="radio-option">
                        <input
                          type="radio"
                          id="{{ block.id }}-{{ forloop.index }}"
                          name="contact[{{ block.settings.label | handle }}]"
                          value="{{ option | strip }}"
                          {% if block.settings.required %}
                            required
                          {% endif %}
                        >
                        <label for="{{ block.id }}-{{ forloop.index }}">
                          {{ option | strip }}
                        </label>
                      </div>
                    {% endfor %}
                  </div>
                {% else %}
                  <input
                    type="{{ block.settings.input_type }}"
                    {% if block.settings.readonly == true %}
                      readonly
                      value="{{ block.settings.placeholder }}"
                    {% endif %}
                    name="contact[{{ block.settings.label | handle }}]"
                    placeholder="{{ block.settings.placeholder }}"
                    {% if block.settings.required %}
                      required
                    {% endif %}
                  >
              {% endcase %}
              <p class="field-error" data-error-for="{{ block.settings.label | handle }}"></p>
            </div>
          {% endfor %}

          {% if section.settings.show_consent %}
            <div class="form-consent">
              <input type="checkbox" name="contact[userconsent]" required id="userconsent-{{ section.id }}">
              <label for="userconsent-{{ section.id }}">
                {{- section.settings.consent_text }}
                <span class="markedrequired">*</span></label
              >
            </div>
            <p class="field-error" data-error-for="userconsent"></p>
          {% endif %}
          <p class="form-success-message"></p>
          <button type="submit" class="submitbtn">
            {{ section.settings.button_text }}
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const links = document.querySelectorAll('a[href="#{{ section.settings.formids }}"]');
    const popup = document.getElementById('{{ section.settings.formids }}');
    const closeBtn = popup ? popup.querySelector('.close-btn') : null;

    if (links.length && popup) {
      // Open popup from any matching link
      links.forEach(function (link) {
        link.addEventListener('click', function (e) {
          e.preventDefault();
          popup.style.display = 'block';
        });
      });

      // Close popup
      if (closeBtn) {
        closeBtn.addEventListener('click', function () {
          popup.style.display = 'none';
        });
      }
    }

    // form submission
    const form = document.getElementById('custompopup-form-{{ section.settings.formids }}');
    form.addEventListener('submit', async function (e) {
      e.preventDefault(); // stop Shopify default submit
      await handleFormSubmission(form);
    });
    // end
  });
</script>
{% comment %} form submission {% endcomment %}
<script src="{{ 'form-handle.js' | asset_url }}" defer></script>
{% comment %} end {% endcomment %}

{% schema %}
{
  "name": "Popup Form",
  "settings": [
    {
      "type": "text",
      "id": "formids",
      "label": "Popup Form Id"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Left Image"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Call Back Request"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "We would love to hear from you!"
    },
    {
      "type": "checkbox",
      "id": "show_consent",
      "label": "Show consent checkbox",
      "default": true
    },
    {
      "type": "textarea",
      "id": "consent_text",
      "label": "Consent text",
      "default": "I consent to be contacted via call, SMS, email or WhatsApp regarding products and offers."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Submit"
    }
  ],
  "blocks": [
    {
      "type": "form_field",
      "name": "Form Field",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Field Label",
          "default": "Name"
        },
        {
          "type": "text",
          "id": "placeholder",
          "label": "Placeholder",
          "default": "Enter value"
        },
        {
          "type": "select",
          "id": "input_type",
          "label": "Input Type",
          "default": "text",
          "options": [
            { "value": "text", "label": "Text" },
            { "value": "email", "label": "Email" },
            { "value": "tel", "label": "Phone" },
            { "value": "number", "label": "Number" },
            { "value": "date", "label": "Date" },
            { "value": "textarea", "label": "Textarea" },
            { "value": "select", "label": "Dropdown" },
            { "value": "radio", "label": "Radio Buttons" }
          ]
        },
        {
          "type": "checkbox",
          "id": "readonly",
          "label": "readonly",
          "default": false
        },
        {
          "type": "textarea",
          "id": "select_options",
          "label": "Dropdown Options (comma separated)",
          "default": "Option 1, Option 2",
          "info": "Only used when Input Type is Dropdown"
        },
        {
          "type": "checkbox",
          "id": "required",
          "label": "Required field",
          "default": false
        }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Popup Form",
      "blocks": [
        { "type": "form_field", "settings": { "label": "Name", "input_type": "text", "required": true } },
        { "type": "form_field", "settings": { "label": "Email", "input_type": "email", "required": true } },
        { "type": "form_field", "settings": { "label": "Mobile Number", "input_type": "tel", "required": true } },
        { "type": "form_field", "settings": { "label": "City", "input_type": "text" } },
        { "type": "form_field", "settings": { "label": "Message", "input_type": "textarea" } }
      ]
    }
  ]
}
{% endschema %}
